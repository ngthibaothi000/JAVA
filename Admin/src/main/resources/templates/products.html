<!DOCTYPE html>
<html lang="vi" xmlns:th="https://www.thymeleaf.org/">
<head th:replace="~{fragments::header}">
    <!-- CSS Tùy chỉnh cho UX/UI tốt hơn -->
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }

        .navbar, .sidebar {
            background-color: #007bff;
        }

        .navbar-brand, .nav-link, .sidebar a {
            color: #fff !important;
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }

        .btn-outline-primary {
            border-color: #007bff;
            color: #007bff;
        }

        .btn-outline-primary:hover {
            background-color: #007bff;
            color: #fff;
        }

        .table thead {
            background-color: #007bff;
            color: #fff;
        }

        .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }

        .alert-success, .alert-danger {
            margin-top: 20px;
        }

        .my-product-image {
            object-fit: cover;
            border-radius: 5px;
        }

        .search-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: #fff;
            border-radius: 0.375rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .search-container .form-inline {
            flex-grow: 1;
        }

        .search-container .form-control {
            border-radius: 0.375rem;
            padding: 10px;
            font-size: 1rem;
        }

        .search-container .btn {
            border-radius: 0.375rem;
            padding: 10px 20px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-control::placeholder {
            color: #6c757d;
        }

        .table-container {
            margin-bottom: 30px;
        }

        .modal-content {
            border-radius: 0.375rem;
        }

        .modal-footer .btn {
            border-radius: 0.375rem;
        }

        /* Cải thiện khoảng cách giữa các phần tử trong form */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            margin-bottom: 5px;
        }
    </style>
</head>
<body id="page-top">
<!-- Page Wrapper -->
<div id="wrapper">
    <!-- Sidebar -->
    <ul th:replace="~{fragments::sidebar}"></ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
            <!-- Topbar -->
            <nav th:replace="~{fragments::top-navbar}"></nav>
            <!-- End of Topbar -->

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Search Form -->
                <div class="search-container">
                    <form th:action="@{/search-products/0}" method="get" class="form-inline">
                        <input type="text" class="form-control" placeholder="Tìm kiếm sản phẩm" name="keyword" aria-label="Search" aria-describedby="search-addon" />
                        <button type="submit" class="btn btn-outline-primary">
                            <i class="fas fa-search"></i> Tìm kiếm
                        </button>
                    </form>
                    <a th:href="@{/add-product}" class="btn btn-primary">Thêm sản phẩm</a>
                </div>

                <div th:if="${size == 0}" class="text-center">
                    <p>Không có sản phẩm</p>
                </div>

                <div th:if="${success}" class="text-center alert alert-success">
                    <p th:text="${success}"></p>
                </div>

                <div th:if="${error}" class="text-center alert alert-danger">
                    <p th:text="${error}"></p>
                </div>

                <div th:if="${size > 0}" class="table-container">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th scope="col">Tên</th>
                            <th scope="col">Loại</th>
                            <th scope="col">Giá</th>
                            <th scope="col">Số lượng</th>
                            <th scope="col">Hình ảnh</th>
                            <th scope="col">Cập nhật</th>
                            <th scope="col">Thao tác</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="product : ${products}">
                            <td th:text="${product.name}"></td>
                            <td th:text="${product.category.name}"></td>
                            <td th:text="${product.costPrice}"></td>
                            <td th:text="${product.currentQuantity}"></td>
                            <td>
                                <img class="my-product-image" style="height: 50px; width: 50px;" alt="" th:src="'data:image/jpeg;base64,' + ${product.image}">
                            </td>
                            <td>
                                <a th:href="@{/update-product/{id}(id=${product.id})}" class="btn btn-primary">Cập nhật</a>
                            </td>
                            <td>
                                <a th:if="${product.deleted} == true" th:href="@{/enable-product(id=${product.id})}" class="btn btn-primary">Kích hoạt</a>
                                <a th:if="${product.deleted} == false" th:href="@{/delete-product(id=${product.id})}" class="btn btn-danger">Xóa</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        <li th:if="${currentPage != 0}" class="page-item">
                            <a th:href="@{'/products/' + ${currentPage - 1}}" class="page-link">Trước</a>
                        </li>
                        <li th:each="i : ${#numbers.sequence(1, totalPages)}" th:classappend="${currentPage == i - 1 ? 'active' : ''}" class="page-item">
                            <a th:href="@{'/products/' + ${i - 1}}" class="page-link"><span th:text="${i}"></span></a>
                        </li>
                        <li th:if="${currentPage + 1 != totalPages}" class="page-item">
                            <a th:href="@{'/products/' + ${currentPage + 1}}" class="page-link">Tiếp</a>
                        </li>
                    </ul>
                </nav>
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer th:replace="~{fragments::footer}"></footer>
        <!-- End of Footer -->
    </div>
    <!-- End of Content Wrapper -->
</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a th:replace="~{fragments::scroll}"></a>

<!-- Modal Thêm sản phẩm -->
<div class="modal fade" id="exampleAddProductModal" tabindex="-1" role="dialog" aria-labelledby="exampleAddProductModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleAddProductModalLabel">Thêm mới sản phẩm</h5>
            </div>
            <div class="modal-body">
                <form th:action="@{/save-product}" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="name" class="col-form-label">Tên sản phẩm:</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="category" class="col-form-label">Danh mục:</label>
                        <select id="category" name="category" class="form-control" required>
                            <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="costPrice" class="col-form-label">Giá:</label>
                        <input type="number" class="form-control" id="costPrice" name="costPrice" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="currentQuantity" class="col-form-label">Số lượng:</label>
                        <input type="number" class="form-control" id="currentQuantity" name="currentQuantity" required>
                    </div>
                    <div class="form-group">
                        <label for="image" class="col-form-label">Hình ảnh:</label>
                        <input type="file" class="form-control" id="image" name="image">
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Lưu</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- End Modal -->

<!-- Bootstrap core JavaScript-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
<div th:replace="~{fragments::script}"></div>
</body>
</html>
